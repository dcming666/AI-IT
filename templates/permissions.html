<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ company_name }} - 权限管理</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="admin-container">
        <!-- 管理后台头部 -->
        <header class="admin-header">
            <div class="admin-logo">
                <i class="fas fa-user-shield"></i>
                <h1>{{ company_name }} 权限管理</h1>
            </div>
            <div class="admin-actions">
                <button class="btn btn-secondary" onclick="window.location.href='/admin'">
                    <i class="fas fa-arrow-left"></i> 返回管理后台
                </button>
                <button class="btn btn-success" onclick="showAddUserModal()">
                    <i class="fas fa-user-plus"></i> 添加用户
                </button>
                <button class="btn btn-info" onclick="showAllUsersModal()">
                    <i class="fas fa-users"></i> 查看所有用户
                </button>
                <button class="btn btn-primary" onclick="showAddPermissionModal()">
                    <i class="fas fa-plus"></i> 添加权限
                </button>
            </div>
        </header>

        <!-- 主要内容区域 -->
        <main class="admin-main">
            <!-- 搜索和筛选 -->
            <div class="search-filter">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="搜索用户名..." class="search-input">
                    <button class="search-btn" onclick="searchPermissions()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="filter-options">
                    <select id="permissionFilter" class="filter-select" onchange="filterByPermission()">
                        <option value="">所有权限</option>
                        <option value="admin">管理后台</option>
                        <option value="permissions">权限管理</option>
                        <option value="interactions">交互查询</option>
                        <option value="export">数据导出</option>
                    </select>
                </div>
            </div>

            <!-- 权限管理表格 -->
            <div class="permissions-table-container">
                <h3><i class="fas fa-users-cog"></i> 用户权限管理</h3>
                <div class="table-wrapper">
                    <table class="permissions-table">
                        <thead>
                            <tr>
                                <th>用户名</th>
                                <th>管理后台</th>
                                <th>权限管理</th>
                                <th>交互查询</th>
                                <th>数据导出</th>
                                <th>创建时间</th>
                                <th>更新时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="permissionsTableBody">
                            <!-- 权限记录将在这里动态加载 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- 添加/编辑权限模态框 -->
    <div id="permissionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="permissionModalTitle"><i class="fas fa-user-plus"></i> 添加用户权限</h3>
                <span class="close" onclick="closePermissionModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="permissionForm">
                    <div class="form-group">
                        <label for="username">用户名：</label>
                        <input type="text" id="username" name="username" required placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label>权限设置：</label>
                        <div class="permission-options">
                            <label class="checkbox-label">
                                <input type="checkbox" id="can_access_admin" name="can_access_admin">
                                <span class="checkmark"></span>
                                访问管理后台
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="can_manage_permissions" name="can_manage_permissions">
                                <span class="checkmark"></span>
                                管理权限
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="can_view_interactions" name="can_view_interactions">
                                <span class="checkmark"></span>
                                查看交互记录
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="can_export_data" name="can_export_data">
                                <span class="checkmark"></span>
                                导出数据
                            </label>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> 保存
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closePermissionModal()">
                            <i class="fas fa-times"></i> 取消
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> 确认删除</h3>
                <span class="close" onclick="closeDeleteModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p>确定要删除用户 <strong id="deleteUsername"></strong> 的权限吗？</p>
                <p class="warning-text">此操作不可撤销！</p>
                <div class="form-actions">
                    <button class="btn btn-danger" onclick="confirmDelete()">
                        <i class="fas fa-trash"></i> 确认删除
                    </button>
                    <button class="btn btn-secondary" onclick="closeDeleteModal()">
                        <i class="fas fa-times"></i> 取消
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加用户模态框 -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> 添加新用户</h3>
                <span class="close" onclick="closeAddUserModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label for="newUsername">用户名：</label>
                        <input type="text" id="newUsername" name="username" required placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">密码：</label>
                        <input type="password" id="newPassword" name="password" required placeholder="请输入密码">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">确认密码：</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required placeholder="请再次输入密码">
                    </div>
                    <div class="form-group">
                        <label>权限设置：</label>
                        <div class="permission-options">
                            <label class="checkbox-label">
                                <input type="checkbox" id="new_can_access_admin" name="can_access_admin">
                                <span class="checkmark"></span>
                                访问管理后台
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="new_can_manage_permissions" name="can_manage_permissions">
                                <span class="checkmark"></span>
                                管理权限
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="new_can_view_interactions" name="can_view_interactions">
                                <span class="checkmark"></span>
                                查看交互记录
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="new_can_export_data" name="can_export_data">
                                <span class="checkmark"></span>
                                导出数据
                            </label>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> 创建用户
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeAddUserModal()">
                            <i class="fas fa-times"></i> 取消
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 所有用户模态框 -->
    <div id="allUsersModal" class="modal">
        <div class="modal-content all-users-modal">
            <div class="modal-header">
                <h3><i class="fas fa-users"></i> 所有注册用户</h3>
                <span class="close" onclick="closeAllUsersModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="users-search">
                    <input type="text" id="usersSearchInput" placeholder="搜索用户名..." class="search-input">
                </div>
                <div class="users-list" id="usersList">
                    <!-- 用户列表将在这里动态加载 -->
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeAllUsersModal()">
                        <i class="fas fa-times"></i> 关闭
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/permissions.js') }}"></script>
</body>
</html>
